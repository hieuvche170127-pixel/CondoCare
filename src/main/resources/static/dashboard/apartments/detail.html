<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apartment Detail - ApartmentPro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/globals.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-light">
<div id="sidebar-placeholder"></div>

<main style="padding-left: 260px;" class="p-4">
    <a href="index.html" class="btn btn-outline-secondary mb-4"><i data-lucide="arrow-left"></i> Back to Apartments</a>

    <div class="d-flex justify-content-between align-items-start mb-4">
        <div class="d-flex align-items-start gap-3">
            <div class="bg-primary-subtle rounded p-3">
                <i data-lucide="home" class="text-primary fs-1"></i>
            </div>
            <div>
                <h1 class="h3" id="unitNumber"></h1>
                <span id="statusBadge"></span>
                <p class="text-muted" id="buildingLink"></p>
                <div class="d-flex gap-3 small text-muted">
                    <span id="floor"></span>
                    <span id="addedDate"></span>
                </div>
            </div>
        </div>
        <div class="text-end">
            <p class="small text-muted">Monthly Rent</p>
            <h3 class="text-primary" id="rentPrice"></h3>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body d-flex align-items-center">
                    <i data-lucide="square" class="text-primary me-3"></i>
                    <div>
                        <h3 id="area"></h3>
                        <p class="small text-muted">Square Meters</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body d-flex align-items-center">
                    <i data-lucide="bed" class="text-primary me-3"></i>
                    <div>
                        <h3 id="bedrooms"></h3>
                        <p class="small text-muted">Bedrooms</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body d-flex align-items-center">
                    <i data-lucide="bath" class="text-primary me-3"></i>
                    <div>
                        <h3 id="bathrooms"></h3>
                        <p class="small text-muted">Bathrooms</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body d-flex align-items-center">
                    <i data-lucide="dollar-sign" class="text-primary me-3"></i>
                    <div>
                        <h3 id="pricePerSqm"></h3>
                        <p class="small text-muted">VND/m²</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">General Info</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="equipment-tab" data-bs-toggle="tab" data-bs-target="#equipment" type="button" role="tab">Equipment</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">History</button>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="general" role="tabpanel">
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Apartment Details</div>
                        <div class="card-body" id="aptDetails"></div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Building Information</div>
                        <div class="card-body" id="buildingInfo"></div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">Pricing Information</div>
                        <div class="card-body" id="pricingInfo"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="equipment" role="tabpanel">
            <div class="card">
                <div class="card-header">Apartment Equipment</div>
                <div class="card-body">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>Equipment</th>
                            <th>Quantity</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody id="equipmentTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="history" role="tabpanel">
            <div class="card">
                <div class="card-header">Apartment History</div>
                <div class="card-body" id="historyTimeline"></div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../data.js"></script>
<script>
    lucide.createIcons();
    fetch('../sidebar.html').then(r => r.text()).then(html => document.getElementById('sidebar-placeholder').innerHTML = html);

    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const apt = getApartmentById(id);
    if (!apt) {
      document.querySelector('main').innerHTML = '<h3>Apartment not found</h3>';
      return;
    }

    const building = getBuildingById(apt.buildingId);

    document.getElementById('unitNumber').textContent = apt.unitNumber;
    document.getElementById('statusBadge').innerHTML = getStatusBadge(apt.status);
    document.getElementById('buildingLink').innerHTML = `<a href="../buildings/detail.html?id=${apt.buildingId}">${building.name}</a>`;
    document.getElementById('floor').innerHTML = `<i data-lucide="layers"></i> Floor ${apt.floor}`;
    document.getElementById('addedDate').innerHTML = `<i data-lucide="calendar"></i> Added ${apt.createdAt}`;
    document.getElementById('rentPrice').textContent = formatCurrency(apt.rentPrice);
    document.getElementById('area').textContent = apt.area;
    document.getElementById('bedrooms').textContent = apt.bedrooms;
    document.getElementById('bathrooms').textContent = apt.bathrooms;
    document.getElementById('pricePerSqm').textContent = formatCurrency(apt.rentPrice / apt.area);

    // Render general
    document.getElementById('aptDetails').innerHTML = `
      <p><strong>Unit Number:</strong> ${apt.unitNumber}</p>
      <p><strong>Floor:</strong> ${apt.floor}</p>
      <p><strong>Area:</strong> ${apt.area} m²</p>
      <p><strong>Status:</strong> ${getStatusBadge(apt.status)}</p>
      <p><strong>Bedrooms:</strong> ${apt.bedrooms}</p>
      <p><strong>Bathrooms:</strong> ${apt.bathrooms}</p>
      <p><strong>Description:</strong> ${apt.description || 'N/A'}</p>
    `;

    document.getElementById('buildingInfo').innerHTML = `
      <p><strong>Name:</strong> ${building.name}</p>
      <p><strong>Address:</strong> ${building.address}</p>
      <p><strong>Total Floors:</strong> ${building.totalFloors}</p>
      <p><strong>Total Units:</strong> ${building.totalApartments}</p>
      <a href="../buildings/detail.html?id=${building.id}" class="btn btn-outline-primary w-100">View Building Details</a>
    `;

    document.getElementById('pricingInfo').innerHTML = `
      <div class="row g-3">
        <div class="col-md-3"><div class="p-3 bg-light rounded"><small>Monthly Rent</small><h5>${formatCurrency(apt.rentPrice)}</h5></div></div>
        <div class="col-md-3"><div class="p-3 bg-light rounded"><small>Price per m²</small><h5>${formatCurrency(apt.rentPrice / apt.area)}</h5></div></div>
        <div class="col-md-3"><div class="p-3 bg-light rounded"><small>Created</small><h5>${apt.createdAt}</h5></div></div>
        <div class="col-md-3"><div class="p-3 bg-light rounded"><small>Last Updated</small><h5>${apt.updatedAt}</h5></div></div>
      </div>
    `;

    // Render equipment
    const equipmentTbody = document.getElementById('equipmentTable');
    mockEquipment.forEach(e => {
      equipmentTbody.innerHTML += `
        <tr>
          <td>${e.name}</td>
          <td>${e.quantity}</td>
          <td><span class="badge ${e.status === 'Good' ? 'bg-success-subtle text-success-emphasis' : 'bg-warning-subtle text-warning-emphasis'}">${e.status}</span></td>
        </tr>
      `;
    });

    // Render history
    const historyDiv = document.getElementById('historyTimeline');
    mockHistory.forEach(h => {
      historyDiv.innerHTML += `
        <div class="d-flex align-items-start mb-3">
          <div class="me-3"><div class="bg-primary rounded-circle p-2"></div></div>
          <div>
            <p>${h.action}</p>
            <small>${h.date} by ${h.user}</small>
          </div>
        </div>
      `;
    });
</script>
</body>
</html>