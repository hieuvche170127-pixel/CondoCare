<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ApartmentPro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/globals.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-light">
<div id="sidebar-placeholder"></div>

<main class="ms-0 ms-lg-5 p-4" style="padding-left: 260px;">
    <h1 class="h3 fw-bold">Dashboard</h1>
    <p class="text-muted">Chào mừng trở lại, Hiếu.</p>

    <!-- Stats -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body d-flex align-items-center">
                    <i data-lucide="building-2" class="me-3 text-primary fs-3"></i>
                    <div>
                        <h5 class="card-title">Total Buildings</h5>
                        <h3 id="total-buildings"></h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body d-flex align-items-center">
                    <i data-lucide="home" class="me-3 text-primary fs-3"></i>
                    <div>
                        <h5 class="card-title">Total Apartments</h5>
                        <h3 id="total-apts"></h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body d-flex align-items-center">
                    <i data-lucide="trending-up" class="me-3 text-primary fs-3"></i>
                    <div>
                        <h5 class="card-title">Occupancy Rate</h5>
                        <h3 id="occupancy"></h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body d-flex align-items-center">
                    <i data-lucide="wrench" class="me-3 text-primary fs-3"></i>
                    <div>
                        <h5 class="card-title">Under Maintenance</h5>
                        <h3 id="maintenance"></h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Apartment Status & Recent Activities -->
    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">Apartment Status by Building</div>
                <div class="card-body" id="status-by-building"></div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">Recent Activities</div>
                <div class="card-body" id="recent-activities"></div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="data.js"></script>
<script>
    lucide.createIcons();

    // Load sidebar
    fetch('sidebar.html').then(r => r.text()).then(html => document.getElementById('sidebar-placeholder').innerHTML = html);

    // Render stats
    document.getElementById('total-buildings').textContent = buildings.length;
    document.getElementById('total-apts').textContent = apartments.length;
    const occupied = apartments.filter(a => a.status === 'OCCUPIED').length;
    const occupancy = apartments.length > 0 ? Math.round(occupied / apartments.length * 100) : 0;
    document.getElementById('occupancy').textContent = occupancy + '%';
    const maintenance = apartments.filter(a => a.status === 'MAINTENANCE').length;
    document.getElementById('maintenance').textContent = maintenance;

    // Render status by building
    const statusDiv = document.getElementById('status-by-building');
    buildings.forEach(b => {
      const bApts = getApartmentsByBuildingId(b.id);
      const bOccupied = bApts.filter(a => a.status === 'OCCUPIED').length;
      const bAvailable = bApts.filter(a => a.status === 'AVAILABLE').length;
      const bMaint = bApts.filter(a => a.status === 'MAINTENANCE').length;
      const total = bApts.length;
      const occupiedPct = total > 0 ? (bOccupied / total * 100) : 0;
      const availablePct = total > 0 ? (bAvailable / total * 100) : 0;
      const maintPct = total > 0 ? (bMaint / total * 100) : 0;

      statusDiv.innerHTML += `
        <div class="mb-4">
          <div class="d-flex justify-content-between">
            <span>${b.name}</span>
            <span>${total} units</span>
          </div>
          <div class="progress" role="progressbar" aria-valuenow="${occupiedPct}" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar bg-success" style="width: ${occupiedPct}%"></div>
            <div class="progress-bar bg-primary" style="width: ${availablePct}%"></div>
            <div class="progress-bar bg-warning" style="width: ${maintPct}%"></div>
          </div>
          <div class="d-flex gap-3 small text-muted">
            <span>Occupied: ${bOccupied}</span>
            <span>Available: ${bAvailable}</span>
            <span>Maintenance: ${bMaint}</span>
          </div>
        </div>
      `;
    });

    // Render recent activities (mock)
    const activitiesDiv = document.getElementById('recent-activities');
    activitiesDiv.innerHTML = `
      <div class="list-group">
        <a href="#" class="list-group-item list-group-item-action">New resident moved in - A101</a>
        <a href="#" class="list-group-item list-group-item-action">Maintenance completed - B302</a>
        // thêm thêm...
      </div>
    `;
</script>
</body>
</html>